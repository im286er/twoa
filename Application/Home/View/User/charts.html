<link rel="stylesheet" href="__PUBLIC__/components/bootstrap-multiselect/dist/css/bootstrap-multiselect.css" />
<link rel="stylesheet" href="__PUBLIC__/components/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css">
<link rel="stylesheet" href="__PUBLIC__/components/bootstrap-daterangepicker/daterangepicker.css" />
<link rel="stylesheet" href="__PUBLIC__/components/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.css" />
<style>
	#chartsDody{display: none;}
</style>
<div class="page-header" style="color:#ffffff">
	<h1>
		人事管理
		<small>
			<i class="ace-icon fa fa-bar-chart-o"></i>
			图表统计
		</small>
	</h1>
</div><!-- /.page-header -->
<div id="chartsDody" class="row">
	<div class="col-xs-12">
		<div class="row">
			<div class="col-xs-12 col-sm-4">
				<div class="search-area well well-sm">
					<div class="search-filter-header bg-primary">
						<h5 class="smaller no-margin-bottom">
							<i class="ace-icon fa fa-sliders light-green bigger-130"></i>&nbsp; 筛选条件
						</h5>
					</div>	
					<div class="hr hr-dotted"></div>
					
					
					<form class="form-horizontal">
						<div class="form-group">
							<div class="col-xs-12 col-sm-6">
								<select name="" class="form-control">
									<option value="user_company">公司</option>
									<option value="user_department">部门</option>
								</select>
							</div>
						</div>
						<div class="hr hr-dotted"></div>

						<div class="form-group">
								<label class="control-label col-xs-12 col-sm-3 no-padding-right" style="padding-top: 7px;">
									<input name="form-field-checkbox" class="ace" type="checkbox">
									<span class="lbl">&nbsp;公司</span>
								</label>

						
							<div class="col-xs-12 col-sm-9">
								<select name="select-company" class="multiselect"  multiple="">
									<volist name="companyDataArray" id="companyData">
										<option value="{$companyData.company_id}">{$companyData.company_name}</option>
									</volist>
								</select>
							</div>
							
						</div>

						<div class="form-group">

								<label class="control-label col-xs-12 col-sm-3 no-padding-right" style="padding-top: 7px;">
									<input name="form-field-checkbox" class="ace" type="checkbox">
									<span class="lbl">&nbsp;部门</span>
								</label>

						
							<div class="col-xs-12 col-sm-9">
								<select id="" class="multiselect" multiple="">
									<volist name="departmentDataArray" id="departmentData">
										<option value="{$departmentData.department_id}">{$departmentData.department_name}</option>
									</volist>
								</select>
							</div>
						</div>
						<div class="form-group">

							<label class="control-label col-xs-12 col-sm-3 no-padding-right" style="padding-top: 7px;">
								<input name="form-field-checkbox" class="ace" type="checkbox">
								<span class="lbl">&nbsp;性别</span>
							</label>						
							<div class="col-xs-12 col-sm-9">
								<select id="" class="multiselect" multiple="">
									<option value="男">男</option>
									<option value="女">女</option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-xs-12 col-sm-3 no-padding-right" style="padding-top: 7px;">
								<input name="form-field-checkbox"  class="ace" type="checkbox">
								<span class="lbl">&nbsp;出生</span>
							</label>						
							<div class="col-xs-12 col-sm-6">
								<!-- #section:plugins/date-time.daterangepicker -->
								<div class="input-group">
									<span class="input-group-addon">
										<i class="fa fa-calendar bigger-110"></i>
									</span>

									<input class="form-control" type="text" name="date-range-picker" id="id-date-range-picker-1" />
								</div>

								<!-- /section:plugins/date-time.daterangepicker -->
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-xs-12 col-sm-3 no-padding-right" style="padding-top: 7px;">
								<input name="form-field-checkbox"  class="ace" type="checkbox">
								<span class="lbl">&nbsp;入职</span>
							</label>						
							<div class="col-xs-12 col-sm-6">
								<!-- #section:plugins/date-time.daterangepicker -->
								<div class="input-group">
									<span class="input-group-addon">
										<i class="fa fa-calendar bigger-110"></i>
									</span>

									<input class="form-control" type="text" name="date-range-picker" id="entry-date" />
								</div>

								<!-- /section:plugins/date-time.daterangepicker -->
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-xs-12 col-sm-3 no-padding-right" style="padding-top: 7px;">
								<input name="form-field-checkbox"  class="ace" type="checkbox">
								<span class="lbl">&nbsp;离职</span>
							</label>						
							<div class="col-xs-12 col-sm-6">
								<!-- #section:plugins/date-time.daterangepicker -->
								<div class="input-group">
									<span class="input-group-addon">
										<i class="fa fa-calendar bigger-110"></i>
									</span>

									<input class="form-control" type="text" name="date-range-picker" id="entry-date" />
								</div>

								<!-- /section:plugins/date-time.daterangepicker -->
							</div>
						</div>
					</form>
					<div class="hr hr-dotted"></div>
					<div class="hr hr-dotted hr-24"></div>
					<div class="text-center">
						<button type="button" class="btn btn-default btn-round btn-white" id="create-charts">
							<i class="ace-icon fa fa-refresh green"></i>
							生成图表
						</button>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-sm-7">
				<div class="row">
					<div class="widget-box">
						<div class="widget-header widget-header-flat widget-header-small">
							<h5 class="widget-title">
								<i class="ace-icon fa fa-signal"></i>
								图表
							</h5>
						</div>
						<div class="widget-body">
							<div class="widget-main">
								<div id="piechart-placeholder"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<table class="table table-striped table-bordered">
						<thead>
							<tr>
								<th class="center">#</th>
								<th>Product</th>
								<th class="hidden-xs">Description</th>
								<th class="hidden-480">Discount</th>
								<th>Total</th>
							</tr>
						</thead>

						<tbody>
							<tr>
								<td class="center">1</td>

								<td>
									<a href="#">google.com</a>
								</td>
								<td class="hidden-xs">
									1 year domain registration
								</td>
								<td class="hidden-480"> --- </td>
								<td>$10</td>
							</tr>

							<tr>
								<td class="center">2</td>

								<td>
									<a href="#">yahoo.com</a>
								</td>
								<td class="hidden-xs">
									5 year domain registration
								</td>
								<td class="hidden-480"> 5% </td>
								<td>$45</td>
							</tr>

							<tr>
								<td class="center">3</td>
								<td>Hosting</td>
								<td class="hidden-xs"> 1 year basic hosting </td>
								<td class="hidden-480"> 10% </td>
								<td>$90</td>
							</tr>

							<tr>
								<td class="center">4</td>
								<td>Design</td>
								<td class="hidden-xs"> Theme customization </td>
								<td class="hidden-480"> 50% </td>
								<td>$250</td>
							</tr>
						</tbody>
					</table>
				</div>
				
			</div>
		</div>
	</div>
</div>
<select name="colorpicker" class="hide">
	<option value="#ac725e">#ac725e</option>
	<option value="#d06b64">#d06b64</option>
	<option value="#f83a22">#f83a22</option>
	<option value="#fa573c">#fa573c</option>
	<option value="#ff7537">#ff7537</option>
	<option value="#ffad46">#ffad46</option>
	<option value="#42d692">#42d692</option>
	<option value="#16a765">#16a765</option>
	<option value="#7bd148">#7bd148</option>
	<option value="#b3dc6c">#b3dc6c</option>
	<option value="#fbe983">#fbe983</option>
	<option value="#fad165">#fad165</option>
	<option value="#92e1c0">#92e1c0</option>
	<option value="#9fe1e7">#9fe1e7</option>
	<option value="#9fc6e7">#9fc6e7</option>
	<option value="#4986e7">#4986e7</option>
	<option value="#9a9cff">#9a9cff</option>
	<option value="#b99aff">#b99aff</option>
	<option value="#c2c2c2">#c2c2c2</option>
	<option value="#cabdbf">#cabdbf</option>
	<option value="#cca6ac">#cca6ac</option>
	<option value="#f691b2">#f691b2</option>
	<option value="#cd74e6">#cd74e6</option>
	<option value="#a47ae2">#a47ae2</option>
	<option value="#555">#555</option>
</select>
<script src="__PUBLIC__/components/Flot/jquery.flot.js"></script>
<script src="__PUBLIC__/components/Flot/jquery.flot.pie.js"></script>
<script src="__PUBLIC__/components/Flot/jquery.flot.resize.js"></script>
<script src="__PUBLIC__/components/_mod/bootstrap-multiselect/bootstrap-multiselect.js"></script>
<script src="__PUBLIC__/components/bootstrap-datepicker/dist/js/bootstrap-datepicker.js"></script>
<script src="__PUBLIC__/components/moment/moment.js"></script>
<script src="__PUBLIC__/components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script src="__PUBLIC__/assets/js/src/elements.colorpicker.js"></script>
<script src="__PUBLIC__/components/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.js"></script>
<script>
	$(function(){

		$('input[name=date-range-picker]').daterangepicker({
					'applyClass' : 'btn-sm btn-success',
					'cancelClass' : 'btn-sm btn-default',
					locale: {
						format: 'YYYY-MM-DD',
						applyLabel: '确定',
						cancelLabel: '取消',
					}
				}).prev().on(ace.click_event, function(){
					$(this).next().focus();
				});
		 //公司选择
		$('.multiselect').multiselect({
			enableFiltering: true,
			enableHTML: true,
			buttonClass: 'btn btn-white btn-primary',
			templates: {
				button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> &nbsp;<b class="fa fa-caret-down"></b></button>',
				ul: '<ul class="multiselect-container dropdown-menu"></ul>',
				filter: '<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span><input class="form-control multiselect-search" type="text"></div></li>',
				filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default btn-white btn-grey multiselect-clear-filter" type="button"><i class="fa fa-times-circle red2"></i></button></span>',
				li: '<li><a tabindex="0"><label></label></a></li>',
		       divider: '<li class="multiselect-item divider"></li>',
		       liGroup: '<li class="multiselect-item multiselect-group"><label></label></li>'
			}
		});

		/*画图开始*/
		var placeholder = $('#piechart-placeholder').css({'width':'90%' , 'min-height':'250px'});
		
		var data = [
			{ label: "男",  data: 38.7, color: "#68BC31"},
			{ label: "search engines",  data: 24.5, color: "#2091CF"},
			{ label: "ad campaigns",  data: 8.2, color: "#AF4E96"},
			{ label: "direct traffic",  data: 18.6, color: "#DA5430"},
			{ label: "other",  data: 10, color: "#FEE074"}
		  ]
		  //画图函数开始
		  function drawPieChart(placeholder, data, position) {
		 	  $.plot(placeholder, data, {
				series: {
					pie: {
						show: true,
						tilt:0.8,
						highlight: {
							opacity: 0.25
						},
						stroke: {
							color: '#fff',
							width: 2
						},
						startAngle: 2
					}
				},
				legend: {
					show: true,
					position: position || "ne", 
					labelBoxBorderColor: null,
					margin:[-30,15]
				}
				,
				grid: {
					hoverable: true,
					clickable: true
				}
			 })
		 }
		 //画图函数开始结束
		placeholder.data('chart', data);
		placeholder.data('draw', drawPieChart);
		  //pie chart tooltip example
		  var $tooltip = $("<div class='tooltip top in'><div class='tooltip-inner'></div></div>").hide().appendTo('body');
		  var previousPoint = null;
		
		  placeholder.on('plothover', function (event, pos, item) {
			if(item) {
				if (previousPoint != item.seriesIndex) {
					previousPoint = item.seriesIndex;
					var tip = item.series['label'] + " : " + item.series['percent']+'%';
					$tooltip.show().children(0).text(tip);
				}
				$tooltip.css({top:pos.pageY + 10, left:pos.pageX + 10});
			} else {
				$tooltip.hide();
				previousPoint = null;
			}
			
		 });
		 /*画图结束*/

		//生成图表
		$("#create-charts").on("click",function(){
			//公司
			var comapny=$("select[name='select-company'] option:selected")
			postData=""
			var colors=$("select[name='colorpicker']")
			comapny.each(function(index){
				// console.log($(this).text())
				postData+=$(this).val()+","
			})
			postData=postData.substring(0,postData.length-1)
			console.log(postData)
			var datas = [
			{ label: "男",  data: 20, color: "#68BC31"}
		  ]

		 	$.ajax({
		 		url:"{:U('charts_data')}",
		 		type:"post",
		 		data:{postData:postData},
		 		dataType:"json",
		 		success:function(data){
		 			chartsData=[]
		 			// console.log(data)
		 			for(index in data){
		 				console.log(data[index].count)
		 				chartsData.push({label:data[index].user_company,  data:data[index].count , color: colors.eq(index).val()})
		 			}
		 			drawPieChart(placeholder, chartsData);
		 			// console.log(chartsData)
		 			// drawPieChart(placeholder, chartsData);
		 			
		 			// drawPieChart(placeholder, chartsData);
		 		}
		 	})
			
		})
		//
		$("#chartsDody").css("display","block");
	})
</script>